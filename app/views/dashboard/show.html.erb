<div class="chart-header-container">
  <span id='group-one-header'>Group 1</span>
  <span id='group-two-header'>Group 2</span>
  <span id='data-header'>Data to Display</span>
  <span id='chart-type-header'>Chart Type</span>
</div>
<div class="chart-selection-container">
  <span class='group-one-selection'>
    Ploidy <%= select_tag 'ploidyOne', options_for_select(["N/A", "true", "false"]) %>
    Diet <%= select_tag 'dietOne', options_for_select(["N/A", "rapamycin", "control"]) %>
  </span>

  <span class='group-two-selection'>
    Ploidy <%= select_tag 'ploidyTwo', options_for_select(["N/A", "true", "false"]) %>
    Diet <%= select_tag 'dietTwo', options_for_select(["N/A", "rapamycin", "control"]) %>
  </span>

  <span class='data-selection'>
    <%= select_tag 'display-data', options_for_select(["Protein Levels", "Harvest Brain Temperature", "Weight"]) %>
  </span>

  <span class='chart-selection'>
    <%= select_tag 'graph-type', options_for_select(["Line", "Circle", "Bar"]) %>
  </span>
</div>

<%= submit_tag "Create Chart", id: 'query', class: 'card-button' %>

<canvas id="myChartOne" width="1600" height="900"></canvas>
<canvas id="myChartTwo" width="1600" height="900"></canvas>

<script>

  $('.query').on("click", constructMouseQuery)

  var API = 'http://localhost:3000/';
  var ploidyOne = null;
  var ploidyTwo = null;
  var dietOne = null;
  var dietTwo = null;
  var displayData = null;
  var graphType = null;
  var dataGroupOne;
  var dataGroupTwo;
  var labelsGroupOne;
  var labelsGroupTwo;


    $('#ploidyOne').change(function() {
      ploidyOne = $('#ploidyOne option:selected').text();
    })

    $('#ploidyTwo').change(function() {
      ploidyTwo = $('#ploidyTwo option:selected').text();
    })

    $('#dietOne').change(function() {
      dietOne = $('#dietOne option:selected').text();
    })

    $('#dietTwo').change(function() {
      dietTwo = $('#dietTwo option:selected').text();
    })

    $('#display-data').change(function() {
      displayData = $('#display-data option:selected').text();
    })

    $('#graph-type').change(function() {
      graphType = $('#graph-type option:selected').text();
    })

  function constructMouseQuery()  {
    console.log(ploidyOne)
    console.log(ploidyTwo)
    console.log(dietOne)
    console.log(dietTwo)
    console.log(displayData)
    console.log(graphType)
    getGroupOneMice();
    getGroupTwoMice();
    renderCharts();
  }

  function dataToDisplayGroupOne(array, type) {
    var filteredData = array.filter(mouse => mouse[type])
    var graphData = filteredData.reduce((accumulator, mouse) => {

      accumulator[mouse.original_id] = mouse.weight_in_grams
      return accumulator
    }, {})
      dataGroupOne = Object.values(graphData)
      labelsGroupOne = Object.keys(graphData)
  }

  function dataToDisplayGroupTwo(array, type) {
    var filteredData = array.filter(mouse => mouse[type])
    var graphData = filteredData.reduce((accumulator, mouse) => {

      accumulator[mouse.original_id] = mouse.weight_in_grams
      return accumulator
    }, {})
      dataGroupTwo = Object.values(graphData)
      labelsGroupTwo = Object.keys(graphData)
  }

  function getGroupOneMice()  {
    fetch(`${API}/api/v1/mice/find?trisomic=${ploidyOne}&diet=${dietOne}`)
      .then(response => response.json())
      .then(data => {
        dataToDisplayGroupOne(data, 'weight_in_grams')
      })
  }

  function getGroupTwoMice()  {
    fetch(`${API}/api/v1/mice/find?trisomic=${ploidyTwo}&diet=${dietTwo}`)
      .then(response => response.json())
      .then(data => {
        dataToDisplayGroupTwo(data, 'weight_in_grams')
      })
  }


  function renderCharts()  {
    var ctxOne = document.getElementById("myChartOne");
    var myChartOne = new Chart(ctxOne, {
      type: 'bar',
      data: {
        labels: labelsGroupOne,
        datasets: [
          {
            data: dataGroupOne
          }
        ]
      }
    });

    var ctxTwo = document.getElementById("myChartTwo");
    var myChartTwo = new Chart(ctxTwo, {
      type: 'bar',
      data: {
        labels: labelsGroupTwo,
        datasets: [
          {
            data: dataGroupTwo
          }
        ]
      }
    });
  }


</script>
